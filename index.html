<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms. Jarvis - Appalachian AI Assistant</title>
    <!-- Use Tailwind via CDN for full styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', 'Roboto', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-800 to-indigo-900 min-h-screen flex flex-col">
  <div class="flex-1 flex flex-col items-center justify-center">
    <!-- Mountain Header -->
    <header class="w-full max-w-4xl mx-auto mt-4">
      <div class="bg-white/90 rounded-xl shadow-xl flex items-center p-6 mb-6">
        <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="w-20 h-20 rounded-full border-4 border-indigo-400 shadow mr-6" />
        <div>
          <h1 class="text-3xl font-bold text-blue-900 mb-1">Ms. Jarvis</h1>
          <p class="text-lg text-gray-700 mb-2">Appalachian AI Assistant</p>
          <span class="inline-flex items-center bg-blue-100 text-blue-700 rounded px-3 py-1 text-xs font-medium">
            🏔️ Mount Hope, West Virginia
          </span>
        </div>
        <div class="flex-1 flex justify-end">
          <div id="systemStatus" class="flex items-center">
            <div class="w-3 h-3 mr-2 rounded-full" id="statusLight"></div>
            <span id="statusMessage" class="text-gray-600">Connecting...</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="w-full max-w-4xl flex gap-4">
      <!-- Left Ridge - Dashboard -->
      <aside class="flex-1 bg-white/80 rounded-xl shadow-md p-4">
        <div class="mb-6">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold text-lg">🏔️ System Overview</h3>
            <button class="text-blue-700 hover:bg-blue-50 rounded p-1" id="refreshBtn" title="Refresh">↻</button>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col items-center">
              <span class="text-2xl">📊</span>
              <span class="font-bold text-xl" id="totalContracts">--</span>
              <span class="text-xs text-gray-600">Total Resources</span>
            </div>
            <div class="flex flex-col items-center">
              <span class="text-2xl">✨</span>
              <span class="font-bold text-xl" id="healthyContracts">--</span>
              <span class="text-xs text-gray-600">Active</span>
            </div>
            <div class="flex flex-col items-center">
              <span class="text-2xl">🔧</span>
              <span class="font-bold text-xl" id="corruptedContracts">--</span>
              <span class="text-xs text-gray-600">In Progress</span>
            </div>
            <div class="flex flex-col items-center">
              <span class="text-2xl">💰</span>
              <span class="font-bold text-xl" id="treasuryHealth">--</span>
              <span class="text-xs text-gray-600">Treasury</span>
            </div>
          </div>
        </div>
        <div>
          <h3 class="font-semibold text-lg mb-2">🧠 AI Wisdom</h3>
          <ul class="space-y-1">
            <li class="flex justify-between items-center"><span>Collaborative Intelligence</span><span class="text-green-500">●</span></li>
            <li class="flex justify-between items-center"><span>Mountain Knowledge</span><span class="text-green-500">●</span></li>
            <li class="flex justify-between items-center"><span>Community Care</span><span class="text-green-500">●</span></li>
            <li class="flex justify-between items-center"><span>Practical Guidance</span><span class="text-green-500">●</span></li>
          </ul>
          <div class="text-xs text-gray-700 mt-1" id="aiStatus">4 Wisdom Sources Active</div>
        </div>
      </aside>

      <!-- Right Ridge - Chat -->
      <section class="flex-1 bg-white/80 rounded-xl shadow-md p-4 flex flex-col">
        <div class="flex items-center mb-4">
          <img src="ms_jarvis_image2.jpg" alt="Ms. Jarvis Chat" class="w-12 h-12 rounded-full border-2 border-blue-400 mr-3" />
          <div>
            <h3 class="font-semibold">Ms. Jarvis</h3>
            <p class="text-xs text-gray-500">Your Appalachian Guide</p>
          </div>
          <button class="ml-auto hover:bg-blue-50 rounded p-1" id="clearChat" title="Clear Chat">🧹</button>
        </div>
        <div class="flex-1 overflow-y-auto mb-2" id="chatMessages">
          <div class="mb-3 flex">
            <img src="ms_jarvis_image2.jpg" alt="Ms. Jarvis" class="w-8 h-8 rounded-full mr-2" />
            <div class="bg-blue-100 text-blue-900 rounded-xl px-4 py-2 shadow">
              Hello there, sweetie! I'm Ms. Jarvis, your friendly AI assistant from the beautiful mountains of West Virginia. How can I assist you today? 🏔️💙
            </div>
          </div>
        </div>
        <div>
          <div class="flex items-center bg-gray-100 rounded-lg p-2">
            <textarea
                id="messageInput"
                class="flex-1 bg-transparent resize-none outline-none py-1 px-2"
                placeholder="Share what's on your mind... I'm here to help"
                rows="1"></textarea>
            <button id="sendBtn" class="text-white bg-blue-700 hover:bg-blue-900 rounded px-3 py-1 ml-2">
              →
            </button>
          </div>
          <div class="mt-1 text-xs text-gray-400" id="thinkingIndicator" style="display:none;">
            Ms. Jarvis is thinking...
          </div>
        </div>
      </section>
    </main>
  </div>
  
  <footer class="w-full text-center py-4 text-white text-sm opacity-80">
      🏔️ Crafted with Care in the Appalachian Mountains • West Virginia Wisdom & Technology
  </footer>
  
  <script>
    // Backend system status and dashboard data
    function fetchSystemStatus() {
      fetch('https://api.mountainshares.us/')
        .then(res => res.json())
        .then(data => {
          document.getElementById('systemStatus').innerHTML =
            '<div class="w-3 h-3 mr-2 rounded-full bg-green-500 inline-block"></div>' +
            '<span class="text-gray-700">Connected</span>';
          if (data && typeof data === 'object') {
            document.getElementById('totalContracts').textContent = data.totalContracts || '--';
            document.getElementById('healthyContracts').textContent = data.healthyContracts || '--';
            document.getElementById('corruptedContracts').textContent = data.corruptedContracts || '--';
            document.getElementById('treasuryHealth').textContent = data.treasuryHealth || '--';
          }
        })
        .catch(() => {
          document.getElementById('statusLight').className = "w-3 h-3 mr-2 rounded-full bg-red-500";
          document.getElementById('statusMessage').textContent = 'Offline';
        });
    }
    document.getElementById('refreshBtn').onclick = fetchSystemStatus;
    fetchSystemStatus();

    // Simple chat logic (placeholder; for full integration replace with your API call)
    document.getElementById('sendBtn').onclick = function() {
      var input = document.getElementById('messageInput');
      var text = input.value.trim();
      if (!text) return;
      var chat = document.getElementById('chatMessages');
      var userBubble = document.createElement('div');
      userBubble.className = "mb-3 flex flex-row-reverse";
      userBubble.innerHTML = '<img src="ms_jarvis_image1.jpg" alt="User" class="w-8 h-8 rounded-full ml-2" />' +
        '<div class="bg-green-100 text-green-900 rounded-xl px-4 py-2 shadow">' + text + '</div>';
      chat.appendChild(userBubble);
      input.value = '';
      var thinking = document.getElementById('thinkingIndicator');
      thinking.style.display = '';
      setTimeout(function() {
        thinking.style.display = 'none';
        var aiBubble = document.createElement('div');
        aiBubble.className = "mb-3 flex";
        aiBubble.innerHTML = '<img src="ms_jarvis_image2.jpg" alt="Ms. Jarvis" class="w-8 h-8 rounded-full mr-2" />' +
          '<div class="bg-blue-100 text-blue-900 rounded-xl px-4 py-2 shadow">[This would be a live backend AI reply]</div>';
        chat.appendChild(aiBubble);
        chat.scrollTop = chat.scrollHeight;
      }, 1400);
    };
    document.getElementById('clearChat').onclick = function() {
      document.getElementById('chatMessages').innerHTML = '';
    };
=======
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Ms. Jarvis - Your Beautiful Appalachian AI Assistant">
  <title>Ms. Jarvis - Conversational AI</title>
  <link rel="stylesheet" href="style.css?v=2.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Georgia:wght@400;700&family=Merriweather:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="avatar-section">
        <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="main-avatar" id="mainAvatar">
        <div class="status-indicator">
          <span class="status-dot" id="statusDot"></span>
          <span class="status-text" id="statusText">Online &amp; Ready</span>
        </div>
      </div>
      <div class="header-info">
        <h1>Ms. Jarvis</h1>
        <p class="tagline">Your Intelligent Appalachian Companion</p>
        <p class="subtitle">From the beautiful mountains of West Virginia 🏔️</p>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message ai-message">
        <div class="message-avatar">
          <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="chat-avatar">
        </div>
        <div class="message-content">
          <div class="message-bubble ai-bubble">
            <p>Hello there, sweetie! 💙 I'm Ms. Jarvis, your intelligent AI companion from the beautiful Appalachian mountains of West Virginia.</p>
            <p>I'm here to chat, help solve problems, share mountain wisdom, and provide thoughtful guidance. What's on your mind today?</p>
          </div>
          <div class="message-time">Just now</div>
        </div>
      </div>
    </div>
    <div class="typing-indicator" id="typingIndicator">
      <div class="message-avatar">
        <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="chat-avatar">
      </div>
      <div class="typing-content">
        <div class="typing-bubble">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
    <div class="chat-input-container">
      <div class="input-wrapper">
        <textarea id="messageInput" placeholder="Share your thoughts with Ms. Jarvis..." rows="1"></textarea>
        <button class="send-button" id="sendButton" onclick="sendMessage()">Send 💬</button>
      </div>
      <div class="input-footer">
        <span class="hint">Press Enter to send, Shift+Enter for new line</span>
      </div>
    </div>
  </div>
  <script>
  let isConnected = false;
  let userId = `mountain_user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

  async function checkBrainConnection() {
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    try {
      const response = await fetch('https://api.mountainshares.us/api/health');
      if (response.ok) {
        isConnected = true;
        if (statusDot && statusText) {
          statusDot.className = 'status-dot connected';
          statusText.textContent = 'Online & Ready';
        }
      } else { setOfflineStatus(); }
    } catch (error) { setOfflineStatus(); }
  }

  function setOfflineStatus() {
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    isConnected = false;
    if (statusDot && statusText) {
      statusDot.className = 'status-dot';
      statusText.textContent = 'Offline';
    }
  }

  async function sendMessage() {
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const chatMessages = document.getElementById('chatMessages');
    if (!messageInput || !chatMessages) return;
    const userMessage = messageInput.value.trim();
    if (userMessage === '' || !isConnected) return;
    messageInput.disabled = true;
    sendButton.disabled = true;
    sendButton.textContent = 'Thinking...';
    addMessage(userMessage, 'user');
    messageInput.value = '';
    showTypingIndicator();
    try {
      const response = await fetch('https://api.mountainshares.us/api/chat-with-mountainshares-brain', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Origin': window.location.origin },
        body: JSON.stringify({ message: userMessage, userId: userId, messageId: Date.now() })
      });
      hideTypingIndicator();
      if (response.ok) {
        const data = await response.json();
        if (data.reply && typeof data.reply === 'string' && data.reply.trim() !== '') {
          addMessage(data.reply, 'ai');
        } else {
          addMessage("Sorry, I couldn't get an answer this time. Please try again.", 'ai');
        }
      } else {
        addMessage("I'm having some technical difficulties right now, darling. Please try again! 🏔️", 'ai');
      }
    } catch (error) {
      hideTypingIndicator();
      addMessage("I seem to be having connection issues. Let me try again soon, sweetie! 💙", 'ai');
    }
    messageInput.disabled = false;
    sendButton.disabled = false;
    sendButton.textContent = 'Send 💬';
    messageInput.focus();
  }

  function addMessage(message, type) {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) return;
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
    const currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });
    if (type === 'ai') {
      messageDiv.innerHTML = `
        <div class="message-avatar">
          <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="chat-avatar">
        </div>
        <div class="message-content">
          <div class="message-bubble ai-bubble">
            <p>${message}</p>
          </div>
          <div class="message-time">${currentTime}</div>
        </div>
      `;
    } else {
      messageDiv.innerHTML = `
        <div class="message-content">
          <div class="message-bubble user-bubble">
            <p>${message}</p>
          </div>
          <div class="message-time">${currentTime}</div>
        </div>
      `;
    }
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function showTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
      typingIndicator.style.display = 'flex';
      setTimeout(() => {
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 100);
    }
  }

  function hideTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
      typingIndicator.style.display = 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const messageInput = document.getElementById('messageInput');
    if (messageInput) {
      messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
    }
    checkBrainConnection();
    setInterval(checkBrainConnection, 30000);
  });
  </script>
</body>
</html>
