<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ms. Jarvis - Your Beautiful Appalachian AI Assistant">
    <title>Ms. Jarvis - Conversational AI from the Mountains</title>
    <link rel="stylesheet" href="style.css?v=8.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Georgia:wght@400;700&family=Merriweather:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="chat-container">
        <!-- Beautiful Header with Ms. Jarvis -->
        <div class="chat-header">
            <div class="avatar-section">
                <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="main-avatar" id="mainAvatar">
                <div class="status-indicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span class="status-text" id="statusText">Connecting...</span>
                </div>
            </div>
            <div class="header-info">
                <h1>Ms. Jarvis</h1>
                <p class="tagline">Your Intelligent Appalachian Companion</p>
                <p class="subtitle">From the beautiful mountains of West Virginia üèîÔ∏è</p>
            </div>
        </div>

        <!-- Chat Messages Area -->
        <div class="chat-messages" id="chatMessages">
            <div class="message ai-message" id="welcomeMessage">
                <div class="message-avatar">
                    <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="chat-avatar">
                </div>
                <div class="message-content">
                    <div class="message-bubble ai-bubble">
                        <p>Hello there, sweetie! üíô I'm Ms. Jarvis, your intelligent AI companion from the beautiful Appalachian mountains of West Virginia.</p>
                        <p>I'm here to chat, help solve problems, share mountain wisdom, and provide thoughtful guidance. What's on your mind today?</p>
                    </div>
                    <div class="message-time">Just now</div>
                </div>
            </div>
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator" style="display: none;">
            <div class="message-avatar">
                <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="chat-avatar">
            </div>
            <div class="typing-content">
                <div class="typing-bubble">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="chat-input-container">
            <div class="input-wrapper">
                <textarea 
                    id="messageInput" 
                    placeholder="Share your thoughts with Ms. Jarvis..." 
                    rows="1"
                    maxlength="2000"
                ></textarea>
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    <span class="send-text">Send</span>
                    <span class="send-icon">üí¨</span>
                </button>
            </div>
            <div class="input-footer">
                <span class="char-count" id="charCount">0/2000</span>
                <span class="hint">Press Enter to send, Shift+Enter for new line</span>
            </div>
        </div>
    </div>

    <script>
    let messageCount = 0;
    let isConnected = false;
    let userId = `mountain_user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

    // Check Ms. Jarvis Brain Connection
    async function checkBrainConnection() {
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        
        try {
            const response = await fetch('https://api.mountainshares.us/api/health');
            
            if (response.ok) {
                const healthData = await response.json();
                isConnected = true;
                
                if (statusDot && statusText) {
                    statusDot.className = 'status-dot connected';
                    statusText.textContent = 'Online & Ready';
                }
                
                console.log('üèîÔ∏è Ms. Jarvis Brain Connected ‚úÖ');
                showSystemMessage("Connected to mountain wisdom servers ‚ú®");
            } else {
                setOfflineStatus();
            }
        } catch (error) {
            setOfflineStatus();
        }
    }

    function setOfflineStatus() {
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        
        isConnected = false;
        if (statusDot && statusText) {
            statusDot.className = 'status-dot offline';
            statusText.textContent = 'Offline';
        }
        console.log('üî¥ Ms. Jarvis Brain Offline');
    }

    // Enhanced sendMessage with beautiful UX
    async function sendMessage() {
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        
        if (!messageInput || !chatMessages) return;
        
        const userMessage = messageInput.value.trim();
        if (userMessage === '' || !isConnected) return;
        
        // Disable input during processing
        messageInput.disabled = true;
        sendButton.disabled = true;
        sendButton.innerHTML = '<span class="send-text">Sending...</span><span class="send-icon">‚è≥</span>';
        
        // Add user message with beautiful styling
        addMessage(userMessage, 'user');
        
        // Clear input and show typing indicator
        messageInput.value = '';
        updateCharCount();
        showTypingIndicator();
        
        try {
            const response = await fetch('https://api.mountainshares.us/api/chat-with-mountainshares-brain', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Origin': window.location.origin
                },
                body: JSON.stringify({
                    message: userMessage,
                    userId: userId,
                    messageId: ++messageCount
                })
            });

            hideTypingIndicator();

            if (response.ok) {
                const data = await response.json();
                addMessage(data.reply || "I'm having trouble with that request, sweetie. Could you try asking in a different way?", 'ai');
            } else {
                addMessage("I'm having some technical difficulties right now, darling. Please try again in a moment! üèîÔ∏è", 'ai');
            }
        } catch (error) {
            hideTypingIndicator();
            console.error('Brain connection error:', error);
            addMessage("I seem to be having connection issues with the mountain servers. Let me try to get back to you soon, sweetie! üíô", 'ai');
        }
        
        // Re-enable input
        messageInput.disabled = false;
        sendButton.disabled = false;
        sendButton.innerHTML = '<span class="send-text">Send</span><span class="send-icon">üí¨</span>';
        messageInput.focus();
        autoResizeTextarea();
    }

    // Beautiful message display
    function addMessage(message, type) {
        const chatMessages = document.getElementById('chatMessages');
        if (!chatMessages) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        
        const currentTime = new Date().toLocaleTimeString([], {
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true
        });
        
        if (type === 'ai') {
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <img src="ms_jarvis_image1.jpg" alt="Ms. Jarvis" class="chat-avatar">
                </div>
                <div class="message-content">
                    <div class="message-bubble ai-bubble">
                        <p>${message}</p>
                    </div>
                    <div class="message-time">${currentTime}</div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-bubble user-bubble">
                        <p>${message}</p>
                    </div>
                    <div class="message-time">${currentTime}</div>
                </div>
            `;
        }
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Smooth animation
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateY(20px)';
        requestAnimationFrame(() => {
            messageDiv.style.transition = 'all 0.3s ease';
            messageDiv.style.opacity = '1';
            messageDiv.style.transform = 'translateY(0)';
        });
    }

    function showSystemMessage(message) {
        const chatMessages = document.getElementById('chatMessages');
        const systemDiv = document.createElement('div');
        systemDiv.className = 'system-message';
        systemDiv.innerHTML = `<span>${message}</span>`;
        chatMessages.appendChild(systemDiv);
        
        setTimeout(() => {
            systemDiv.style.opacity = '0';
            setTimeout(() => systemDiv.remove(), 300);
        }, 3000);
    }

    function showTypingIndicator() {
        const typingIndicator = document.getElementById('typingIndicator');
        if (typingIndicator) {
            typingIndicator.style.display = 'flex';
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }
    }

    function hideTypingIndicator() {
        const typingIndicator = document.getElementById('typingIndicator');
        if (typingIndicator) {
            typingIndicator.style.display = 'none';
        }
    }

    function autoResizeTextarea() {
        const textarea = document.getElementById('messageInput');
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }

    function updateCharCount() {
        const messageInput = document.getElementById('messageInput');
        const charCount = document.getElementById('charCount');
        if (messageInput && charCount) {
            charCount.textContent = `${messageInput.value.length}/2000`;
        }
    }

    // Initialize everything
    document.addEventListener('DOMContentLoaded', function() {
        const messageInput = document.getElementById('messageInput');
        
        if (messageInput) {
            // Enter to send
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Auto-resize and char count
            messageInput.addEventListener('input', function() {
                autoResizeTextarea();
                updateCharCount();
            });
        }
        
        // Check brain connection
        checkBrainConnection();
        
        // Periodic health checks
        setInterval(checkBrainConnection, 30000);
        
        console.log('üèîÔ∏è Beautiful Ms. Jarvis Interface Loaded Successfully ‚ú®');
    });
    </script>
</body>
</html>
